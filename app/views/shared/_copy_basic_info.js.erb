<!-- shared/_copy_basic_info.js.erb begins -->
<script>
"use strict";

// *deep sigh*
function copyTextToClipboard(text)
{
    if (!navigator.clipboard) {
        const textArea = document.createElement("textarea");

        textArea.value = text;
        textArea.style.top = "0";
        textArea.style.left = "0";
        textArea.style.position = "fixed";

        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();

        try {
            if (!document.execCommand("copy"))
                window.alert("Can't copy the text. Sorry.");
        } catch (e) {
            console.error(e);
            window.alert("Can't copy the text. See the console for details. Sorry.");
        }

        document.body.removeChild(textArea);
        return;
    }

    try {
        navigator.clipboard.writeText(text).then(
            () => {},
            (e) => {
                console.error(e);
                window.alert(e);
            }
        );
    } catch (e) {
        console.error(e);
        window.alert("Can't copy the text. See the console for details. Sorry.");
    }
}

document.addEventListener("DOMContentLoaded", () => {
    document.querySelector("button#copyBasicInfo")?.addEventListener("click", () => {
        let parts = [];

        parts.push("<%= t('activeldap.attributes.device.puavoHostname') %>: <%= device.puavoHostname %>");
        parts.push("URL: <%= request.original_url %>");
        parts.push("<%= t('activeldap.attributes.device.puavoDeviceModel') %>: <%= device.puavoDeviceModel %>");
        parts.push("<%= t('activeldap.attributes.device.puavoDeviceManufacturer') %>: <%= device.puavoDeviceManufacturer %>");
        parts.push("<%= t('activeldap.attributes.device.serialNumber') %>: <%= device.serialNumber %>");
        parts.push("<%= t('activeldap.attributes.device.macAddress') %>: <%= Array(device.macAddress).join(', ') %>");

        const full = parts.join("\n") + "\n";

        copyTextToClipboard(full);
    });

<% if device.puavoConf %>
    document.querySelector("button#copyPuavoconf")?.addEventListener("click", () => {
        copyTextToClipboard(<%= raw JSON.pretty_generate(device.puavoConf) %>);
    });
<% end %>
});

</script>
<!-- shared/_copy_basic_info.js.erb ends -->
